##
# You should look at the following URL's in order to grasp a solid understanding
# of Nginx configuration files in order to fully unleash the power of Nginx.
# https://www.nginx.com/resources/wiki/start/
# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
# https://wiki.debian.org/Nginx/DirectoryStructure
#
# In most cases, administrators will remove this file from sites-enabled/ and
# leave it as reference inside of sites-available where it will continue to be
# updated by the nginx packaging team.
#
# This file will automatically load configuration files provided by other
# applications, such as Drupal or Wordpress. These applications will be made
# available underneath a path with that package name, such as /drupal8.
#
# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
##

# Default server configuration
#
server {
  listen 443 ssl default_server;
  listen [::]:443 ssl default_server;

  #listen 8443;
  server_name _;
  #ssl on;
  ssl_certificate /home/azureuser/cert/inossemtimes.crt;
  ssl_certificate_key /home/azureuser/cert/inossemtimes.rsa;
  ssl_session_timeout 5m;
  ssl_protocols  TLSv1 TLSV1.1 TLSV1.2;
  #ssl_ciphers ALL: TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA256;
  ssl_prefer_server_ciphers on;

	#root /var/www/html;
	root /home/azureuser/www;

	# Add index.php to the list if you are using PHP
	#index index.html index.htm index.nginx-debian.html;

	server_name _;

	proxy_http_version 1.1;

	#location /web {
	#	return 704;
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
	#	root html;
		#root /home/azureuser/www;
	#	index index.html index.htm;
		#add_header 'Access-Control-Allow-Origin' '*';
		#try_files $uri $uri./ /index.html;
	#	try_files $uri $uri/ /index.html;
		#try_files $uri $uri/ =404;
	#}
	location / {
    root   /usr/share/nginx/html;
    index  index.html index.htm;
  }
	location /users/ {
    proxy_pass https://eo-gateway.inossemtimes.com/users/;
    add_header 'Access-Control-Allow-Origin' '*';
    add_header 'Access-Control-Allow-Credentials' 'true';
  }
  location /oms/ {
    rewrite ^/oms/(.*)$ /oms/oms/$1 break;
    proxy_pass https://eo-gateway.inossemtimes.com;
    add_header 'Access-Control-Allow-Origin' '*';
    add_header 'Access-Control-Allow-Credentials' 'true';
  }
  location /filestorage/ {
    proxy_pass https://eo-gateway.inossemtimes.com/filestorage/;
    add_header 'Access-Control-Allow-Origin' '*';
    add_header 'Access-Control-Allow-Credentials' 'true';
  }
}

server {
	listen 80 default_server;
        listen [::]:80 default_server;

	# SSL configuration
	#
	# listen 443 ssl default_server;
	# listen [::]:443 ssl default_server;
	#
	# Note: You should disable gzip for SSL traffic.
	# See: https://bugs.debian.org/773332
	#
	# Read up on ssl_ciphers to ensure a secure configuration.
	# See: https://bugs.debian.org/765782
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!
	#
	# include snippets/snakeoil.conf;

	#root /var/www/html;
	root /home/azureuser/www;

	# Add index.php to the list if you are using PHP
	#index index.html index.htm index.nginx-debian.html;

	server_name _;

	proxy_http_version 1.1;

	#location /web {
	#	return 704;
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
	#	root html;
		#root /home/azureuser/www;
	#	index index.html index.htm;
		#add_header 'Access-Control-Allow-Origin' '*';
		#try_files $uri $uri./ /index.html;
	#	try_files $uri $uri/ /index.html;
		#try_files $uri $uri/ =404;
	#}
	location / {
    root   /usr/share/nginx/html;
    index  index.html index.htm;
  }
	location /users/ {
    proxy_pass https://eo-gateway-test.inossemtimes.com/users/;
    add_header 'Access-Control-Allow-Origin' '*';
    add_header 'Access-Control-Allow-Credentials' 'true';
  }
  location /oms/ {
    rewrite ^/oms/(.*)$ /oms/oms/$1 break;
    proxy_pass https://eo-gateway-test.inossemtimes.com;
    add_header 'Access-Control-Allow-Origin' '*';
    add_header 'Access-Control-Allow-Credentials' 'true';
  }
  location /filestorage/ {
    proxy_pass https://eo-gateway-test.inossemtimes.com/filestorage/;
    add_header 'Access-Control-Allow-Origin' '*';
    add_header 'Access-Control-Allow-Credentials' 'true';
  }
}

